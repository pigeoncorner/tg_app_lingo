<div class="help-section">
    <h2>✅ Проверка грамматики</h2>
    
    <div class="help-card">
        <h3>Назначение функции</h3>
        <p>Проверка грамматики — это автоматический анализ ваших сообщений на английском языке с помощью двух систем: LanguageTool (первый проход) и AI (второй проход). Функция находит ошибки, предлагает исправления и объясняет правила грамматики.</p>
        <div class="screenshot-placeholder">
            <img src="images/help/grammar-main.png" alt="Результат проверки грамматики">
            <p class="img-caption">Скриншот: Детальный анализ грамматики</p>
        </div>
    </div>

    <div class="help-card">
        <h3>Где доступна проверка грамматики</h3>
        <p>Функция автоматически доступна после отправки текста в следующих разделах:</p>
        <ul>
            <li><strong>Free Speech</strong> — после вашего ответа появляется кнопка "✅ Check grammar"</li>
            <li><strong>Dialog</strong> — автоматический анализ каждой вашей реплики</li>
            <li><strong>Monolog</strong> — анализ монолога после отправки</li>
            <li><strong>Retelling</strong> — проверка пересказа</li>
            <li><strong>HR Interview</strong> — анализ ответов на вопросы</li>
            <li><strong>Носитель языка</strong> — при вводе английской фразы</li>
            <li><strong>Variation</strong> — проверка текста вариации</li>
            <li><strong>BAS</strong> — анализ предложений в упражнении</li>
        </ul>
    </div>

    <div class="help-card">
        <h3>Двухэтапная проверка</h3>
        <p>Система использует два независимых прохода для максимальной точности:</p>

        <div class="pass-card pass-one">
            <h4>❱❱ Первый проход (LanguageTool)</h4>
            <p><strong>Что проверяет:</strong></p>
            <ul>
                <li>Грамматические ошибки (времена, согласование, артикли)</li>
                <li>Орфографические ошибки</li>
                <li>Пунктуация</li>
                <li>Порядок слов в предложении</li>
                <li>Использование предлогов</li>
            </ul>
            
            <p><strong>Как работает:</strong></p>
            <ol>
                <li>Система сканирует текст до 5 раз подряд</li>
                <li>На каждом проходе исправляет найденные ошибки</li>
                <li>Повторяет процесс пока не перестанут находиться ошибки</li>
                <li>Выдает промежуточный исправленный вариант</li>
            </ol>

            <div class="screenshot-placeholder">
                <img src="images/help/grammar-pass1.png" alt="Первый проход">
                <p class="img-caption">Скриншот: Результат первого прохода с выделенными ошибками</p>
            </div>

            <p><strong>Формат ошибок:</strong></p>
            <div class="error-example">
                <p><strong>Оригинал:</strong> I <b>1️⃣ go</b> to school yesterday</p>
                <p><strong>Объяснение:</strong> 1️⃣ <em><b>go</b> необходимо заменить на <b>went</b></em></p>
                <p><strong>Промежуточная корректировка:</strong> I went to school yesterday</p>
            </div>
        </div>

        <div class="pass-card pass-two">
            <h4>❱❱ Второй проход (AI)</h4>
            <p><strong>Что проверяет:</strong></p>
            <ul>
                <li>Стилистические улучшения</li>
                <li>Использование времен в контексте</li>
                <li>Правильность предлогов</li>
                <li>Дополнительные рекомендации</li>
            </ul>

            <p><strong>Как работает:</strong></p>
            <ol>
                <li>Получает текст после первого прохода</li>
                <li>Анализирует контекст и смысл</li>
                <li>Предлагает стилистические улучшения</li>
                <li>Выдает итоговый текст</li>
            </ol>

            <div class="screenshot-placeholder">
                <img src="images/help/grammar-pass2.png" alt="Второй проход">
                <p class="img-caption">Скриншот: Результат второго прохода AI</p>
            </div>

            <p><strong>Категории улучшений:</strong></p>
            <div class="improvement-categories">
                <div class="category-item">
                    <p><strong>Предлоги:</strong> Исправление типичных ошибок с предлогами</p>
                    <p class="category-example">in Monday → on Monday</p>
                </div>
                <div class="category-item">
                    <p><strong>Времена:</strong> Корректировка времен в контексте</p>
                    <p class="category-example">I am here since morning → I have been here since morning</p>
                </div>
                <div class="category-item">
                    <p><strong>Дополнительно:</strong> Общие рекомендации по улучшению</p>
                    <p class="category-example">Использование более естественных формулировок</p>
                </div>
            </div>

            <p><strong>Формат вывода:</strong></p>
            <div class="ai-output">
                <p>2️⃣ Рекомендуется использовать предлог "on" с днями недели</p>
                <p>3️⃣ Present Perfect подходит лучше для действия, начавшегося в прошлом</p>
                <p><strong>Итоговый текст:</strong> I have been here since this morning on Monday</p>
            </div>
        </div>
    </div>

    <div class="help-card">
        <h3>Версия носителя языка</h3>
        <p>После двух проходов проверки система показывает, как бы эту фразу сформулировал носитель английского языка:</p>

        <div class="native-version">
            <p><strong>Как сказал бы носитель:</strong></p>
            <p class="native-text">I've been here since Monday morning</p>
        </div>

        <p>Это помогает увидеть разницу между грамматически правильным и естественным вариантом.</p>
    </div>

    <div class="help-card">
        <h3>Интерактивные кнопки с правилами</h3>

        <div class="screenshot-placeholder">
            <img src="images/help/grammar-buttons.png" alt="Кнопки с номерами">
            <p class="img-caption">Скриншот: Интерактивные кнопки для просмотра правил</p>
        </div>

        <p>Под сообщением с анализом отображаются кнопки с цифрами (1️⃣, 2️⃣, 3️⃣...), соответствующие найденным ошибкам:</p>

        <h4>Как пользоваться кнопками:</h4>
        <ol>
            <li>Нажмите на кнопку с номером ошибки (например, 1️⃣)</li>
            <li>Откроется подробное описание грамматического правила</li>
            <li>Кнопка пометится галочкой (1️⃣✅)</li>
            <li>Для возврата к списку ошибок нажмите кнопку "↩"</li>
        </ol>

        <div class="screenshot-placeholder">
            <img src="images/help/grammar-rule.png" alt="Описание правила">
            <p class="img-caption">Скриншот: Детальное описание грамматического правила</p>
        </div>

        <h4>Типы правил:</h4>
        <div class="rule-types">
            <div class="rule-type">
                <p><strong>С подробным описанием (1️⃣, 2️⃣, 3️⃣...):</strong></p>
                <p>Правила с полным объяснением, примерами и рекомендациями</p>
            </div>
            <div class="rule-type">
                <p><strong>Без подробного описания (ℹ️):</strong></p>
                <p>Правила, для которых пока нет детального объяснения в базе данных. Показывается только краткое описание.</p>
            </div>
        </div>

        <div class="tip-box">
            <p><strong>Совет:</strong> Изучайте правила по кнопкам — это помогает понять и запомнить грамматические конструкции.</p>
        </div>
    </div>

    <div class="help-card">
        <h3>Структура результата проверки</h3>
        
        <div class="result-structure">
            <div class="result-section">
                <h4>1. Первоначальная фраза</h4>
                <p>Ваш оригинальный текст с <b>выделенными</b> ошибками</p>
                <p class="example">I <b>1️⃣ go</b> to <b>2️⃣ the</b> school yesterday</p>
            </div>

            <div class="result-section">
                <h4>2. Первый проход (LanguageTool)</h4>
                <p>Список найденных ошибок с объяснениями</p>
                <p class="example">
                    1️⃣ <em><b>go</b> необходимо заменить на <b>went</b></em><br>
                    2️⃣ <em><b>the</b> необходимо заменить на <b>∅</b> (удалить)</em>
                </p>
                <p><strong>Промежуточная корректировка:</strong> I went to school yesterday</p>
            </div>

            <div class="result-section">
                <h4>3. Второй проход (AI)</h4>
                <p>Дополнительные улучшения и рекомендации</p>
                <p class="example">✅ <em>Грамматических ошибок не найдено!</em></p>
                <p><strong>Итоговый текст:</strong> I went to school yesterday</p>
            </div>

            <div class="result-section">
                <h4>4. Как сказал бы носитель</h4>
                <p>Естественная версия фразы</p>
                <p class="example">I was at school yesterday</p>
            </div>

            <div class="result-section">
                <h4>5. Подсказка о кнопках</h4>
                <p>💡 Подробнее правила смотрите по кнопкам (1️⃣...) ниже 👇</p>
            </div>

            <div class="result-section">
                <h4>6. Интерактивные кнопки</h4>
                <p>Кнопки с номерами для просмотра правил + кнопка продолжения</p>
            </div>
        </div>
    </div>

    <div class="help-card">
        <h3>Логирование пропущенных правил</h3>
        <p>Система автоматически отслеживает правила, для которых отсутствуют подробные описания в базе данных:</p>
        <ul>
            <li>Правила с иконкой ℹ️ логируются в системный журнал</li>
            <li>Разработчики получают информацию о недостающих описаниях</li>
            <li>База правил постепенно пополняется новыми объяснениями</li>
        </ul>
        <p class="note">Это помогает улучшать качество проверки грамматики со временем.</p>
    </div>

    <div class="help-card tips">
        <h3>Советы по использованию</h3>
        <ul>
            <li><strong>Читайте все проходы:</strong> Первый находит очевидные ошибки, второй — стилистические</li>
            <li><strong>Изучайте правила:</strong> Нажимайте на кнопки с номерами для понимания ошибок</li>
            <li><strong>Сравнивайте версии:</strong> Смотрите на различия между вашим текстом и исправленным</li>
            <li><strong>Обращайте внимание на носителя:</strong> Финальная версия показывает естественную речь</li>
            <li><strong>Используйте регулярно:</strong> Проверка помогает учиться на ошибках</li>
            <li><strong>Не игнорируйте ℹ️:</strong> Даже без подробного описания краткие пояснения полезны</li>
        </ul>
    </div>

    <div class="help-card">
        <h3>Часто задаваемые вопросы</h3>
        
        <div class="faq-item">
            <h4>Почему система делает два прохода?</h4>
            <p>LanguageTool хорош для точной грамматики, а AI лучше понимает контекст и стиль. Два прохода дают максимально качественный результат.</p>
        </div>

        <div class="faq-item">
            <h4>Всегда ли итоговый текст правильный?</h4>
            <p>Система очень точна, но не идеальна. В редких случаях могут быть ложные срабатывания. Используйте критическое мышление.</p>
        </div>

        <div class="faq-item">
            <h4>Что значит ∅ в исправлениях?</h4>
            <p>Это означает, что слово нужно удалить (например, лишний артикль "the").</p>
        </div>

        <div class="faq-item">
            <h4>Можно ли отключить проверку грамматики?</h4>
            <p>Проверка запускается только при нажатии кнопки "Check grammar" (в Free Speech) или автоматически в других разделах. Вы можете просто пропустить анализ и продолжить.</p>
        </div>

        <div class="faq-item">
            <h4>Почему некоторые кнопки помечены ℹ️ вместо цифр?</h4>
            <p>Для этих правил пока нет подробного описания в базе данных. Показывается только краткое пояснение.</p>
        </div>

        <div class="faq-item">
            <h4>Сколько раз система проверяет текст?</h4>
            <p>Первый проход делает до 5 итераций, второй проход — 1 раз. Итого максимум 6 проверок.</p>
        </div>

        <div class="faq-item">
            <h4>Учитывается ли контекст при проверке?</h4>
            <p>LanguageTool проверяет локально (предложение), AI учитывает более широкий контекст фразы.</p>
        </div>
    </div>
</div>

<style>
.pass-card {
    background: var(--tg-theme-bg-color, #ffffff);
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 20px;
    border-left: 5px solid;
}

.pass-card.pass-one {
    border-left-color: #3b82f6;
    background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
}

.pass-card.pass-two {
    border-left-color: #8b5cf6;
    background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%);
}

.pass-card h4 {
    margin: 0 0 16px 0;
    font-size: 18px;
    color: var(--tg-theme-text-color, #000000);
}

.error-example,
.ai-output {
    background: var(--tg-theme-secondary-bg-color, #f8f9fa);
    padding: 16px;
    border-radius: 8px;
    margin: 16px 0;
    border-left: 3px solid var(--tg-theme-button-color, #3390ec);
}

.error-example p,
.ai-output p {
    margin: 8px 0;
}

.improvement-categories {
    margin: 16px 0;
}

.category-item {
    background: var(--tg-theme-bg-color, #ffffff);
    padding: 12px;
    margin-bottom: 12px;
    border-radius: 6px;
}

.category-item p {
    margin: 4px 0;
}

.category-example {
    color: var(--tg-theme-hint-color, #666666);
    font-style: italic;
    font-size: 14px;
}

.native-version {
    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
    padding: 16px;
    border-radius: 8px;
    margin: 16px 0;
    border-left: 4px solid #f59e0b;
}

.native-text {
    font-size: 18px;
    font-weight: 600;
    margin: 8px 0 0 0;
}

.rule-types {
    margin: 16px 0;
}

.rule-type {
    background: var(--tg-theme-bg-color, #ffffff);
    padding: 12px;
    margin-bottom: 12px;
    border-radius: 6px;
    border: 1px solid var(--tg-theme-section-separator-color, #e5e5e5);
}

.rule-type p {
    margin: 4px 0;
}

.result-structure {
    margin: 16px 0;
}

.result-section {
    background: var(--tg-theme-bg-color, #ffffff);
    padding: 16px;
    margin-bottom: 12px;
    border-radius: 8px;
    border-left: 4px solid var(--tg-theme-button-color, #3390ec);
}

.result-section h4 {
    margin: 0 0 8px 0;
    font-size: 16px;
}

.result-section .example {
    background: #f8f9fa;
    padding: 8px 12px;
    border-radius: 4px;
    margin: 8px 0;
    font-size: 14px;
}

.tip-box {
    background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
    padding: 16px;
    border-radius: 8px;
    margin: 16px 0;
    border-left: 4px solid #0ea5e9;
}

.tip-box p {
    margin: 0;
}

.faq-item {
    background: var(--tg-theme-bg-color, #ffffff);
    padding: 16px;
    border-radius: 8px;
    margin-bottom: 16px;
    border-left: 4px solid var(--tg-theme-hint-color, #999999);
}

.faq-item h4 {
    margin: 0 0 8px 0;
    font-size: 15px;
    color: var(--tg-theme-text-color, #000000);
}

.faq-item p {
    margin: 0;
    line-height: 1.6;
}

.note {
    padding: 12px;
    background: #f0f9ff;
    border-left: 3px solid #0ea5e9;
    border-radius: 4px;
    margin: 12px 0;
    font-size: 14px;
}

@media (max-width: 600px) {
    .pass-card {
        padding: 16px;
    }
}
</style>
